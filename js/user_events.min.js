$((function(){$("#favourite").autocomplete({minLength:0,source:teams,appendTo:"#suggestions",focus:function(e,t){return $("#favourite").val(t.item.label),!1},select:function(e,t){return $("#favourite").val(t.item.label),$("#tshort").val(t.item.value),!1}})})),$(document).ready((function(){var e,t=(new Date).toLocaleDateString("sk-SK");$("#change-pass").on("click",(function(e){e.preventDefault();var n=$("#currentpass").val(),r=$("#pass").val();if(r!==$("#passagain").val())Notification("key text-danger",LANG_ERROR,t,LANG_USERPROFILE_PASSDIDNTMATCH,5e3);else if(r.length<6)Notification("key text-danger",LANG_ERROR,t,LANG_USERPROFILE_PASSATLEAST6,5e3);else{var o="change=pass&currentpass="+n+"&password="+r;$.trim(r).length>0&&$.trim(n).length>0&&$.ajax({type:"POST",url:"/includes/login.php",dataType:"text",contentType:"application/x-www-form-urlencoded; charset=utf-8",data:o,cache:!1,success:function(e){e?(Notification("key text-success",LANG_USERPROFILE_PASSCHANGETITLE,t,LANG_USERPROFILE_PASSCHANGEOK,5e3),$("#currentpass").val(""),$("#pass").val(""),$("#passagain").val("")):Notification("key text-danger",LANG_ERROR,t,LANG_USERPROFILE_PASSCHANGEERROR,5e3)}})}return!1})),e=$("#upload-avatar").croppie({viewport:{width:100,height:100,type:"circle"},enableExif:!0}),$("#upload").on("change",(function(){!function(t,n){if(t.files&&t.files[0]){var r=new FileReader;r.onload=function(t){$(".upload-avatar").addClass("ready"),e.croppie("bind",{url:t.target.result}).then((function(){console.log("jQuery bind complete")}))},r.readAsDataURL(t.files[0])}else alert("Sorry - you're browser doesn't support the FileReader API")}(this)})),$("#change-data").on("click",(function(){$(".upload-avatar").hasClass("ready")&&e.croppie("result",{type:"base64",size:{width:200,height:200},format:"jpeg",circle:!0}).then((function(e){$("#avatar").val(e)}));var n=$("#email").val(),r=$("#tshort").val(),o=$("#lang").val(),i=$("input[name=options]:checked").val();if($("#mailnotify").is(":checked"))var a=1;else a=0;return $.trim(n).length>0&&$.trim(r).length>0&&setTimeout((function(){var e=$("#avatar").val();$.ajax({type:"POST",url:"/includes/login.php",contentType:"application/x-www-form-urlencoded; charset=utf-8",data:{change:"data",mailnotify:a,goalhorn:i,email:n,tshort:r,lang:o,avatar:e},cache:!1,success:function(e){e?(Notification("cogs text-success",LANG_SETTINGS,t,LANG_USERPROFILE_SETTINGSCHANGED,3e3),setTimeout((function(){location.href="/profile"}),3e3)):Notification("cogs text-danger",LANG_SETTINGS,t,LANG_USERPROFILE_SETTINGSERROR,5e3)}})}),1),!1})),$("#sound-1").on("click",(function(){return $("#sound-1").css("color","#075988"),responsiveVoice.speak(LANG_USERPROFILE_MIKECHECK,LANG_USERPROFILE_VOICE,{rate:1,onend:function(){$("#sound-1").css("color","gray")}}),!1})),$("#sound-2").on("click",(function(){$("#sound-2").css("color","#075988");var e=document.createElement("audio");return e.setAttribute("src","/includes/sounds/goal.mp3"),e.play(),setTimeout((function(){$("#sound-2").css("color","gray")}),500),!1}));const n="BIntrrrigzs9rUaiccEhsTjz4D-bLL5r25T7wp36awV9vNzaeDDlVxT3OcreF9VR0xG6dlzBb2XyPvCSEFenwjY";let r=$("#pushnotify").is(":checked");const o=document.querySelector("#pushnotify");if(o){if(o.addEventListener("click",(function(){r?(i("computing"),navigator.serviceWorker.ready.then((e=>e.pushManager.getSubscription())).then((e=>{if(e)return s(e,"DELETE");i("disabled")})).then((e=>e.unsubscribe())).then((()=>i("disabled"))).catch((e=>{console.error("Error when unsubscribing the user",e),i("disabled")}))):(i("computing"),navigator.serviceWorker.ready.then((e=>e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:a(n)}))).then((e=>s(e,"POST"))).then((e=>e&&i("enabled"))).catch((e=>{"denied"===Notification.permission?(console.warn("Notifications are denied by the user."),i("incompatible")):(console.error("Impossible to subscribe to push notifications",e),i("disabled"))})))})),!("serviceWorker"in navigator))return console.warn("Service workers are not supported by this browser"),void i("incompatible");if(!("PushManager"in window))return console.warn("Push notifications are not supported by this browser"),void i("incompatible");if(!("showNotification"in ServiceWorkerRegistration.prototype))return console.warn("Notifications are not supported by this browser"),void i("incompatible");if("denied"===Notification.permission)return console.warn("Notifications are denied by the user"),void i("incompatible");navigator.serviceWorker.register("serviceWorker.js").then((()=>{console.log("[SW] Service worker has been registered"),navigator.serviceWorker.ready.then((e=>e.pushManager.getSubscription())).then((e=>{if(i("disabled"),e)return s(e,"PUT")})).then((e=>e&&i("enabled"))).catch((e=>{console.error("Error when updating the subscription",e)}))}),(e=>{console.error("[SW] Service worker registration failed",e),i("incompatible")}))}function i(e){switch(e){case"enabled":o.disabled=!1,$("label[for='pushnotify']").text(LANG_USERPROFILE_PUSH),r=!0;break;case"disabled":o.disabled=!1,$("label[for='pushnotify']").text(LANG_USERPROFILE_PUSH),r=!1;break;case"computing":o.disabled=!0,$("label[for='pushnotify']").text(LANG_USERPROFILE_LOADING);break;case"incompatible":o.disabled=!0,$("label[for='pushnotify']").text(LANG_USERPROFILE_INCOMPAT);break;default:console.error("Unhandled push button state",e)}}function a(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t),r=new Uint8Array(n.length);for(let e=0;e<n.length;++e)r[e]=n.charCodeAt(e);return r}function s(e,t){const n=e.getKey("p256dh"),r=e.getKey("auth");return fetch("../includes/push_subscription.php",{method:t,body:JSON.stringify({endpoint:e.endpoint,key:n?btoa(String.fromCharCode.apply(null,new Uint8Array(n))):null,token:r?btoa(String.fromCharCode.apply(null,new Uint8Array(r))):null})}).then((()=>e))}}));